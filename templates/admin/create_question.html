{% extends "admin/base_admin.html" %}

{% block title %}Create Question - Admin Panel{% endblock %}

{% block content %}
<h2>Create New Question</h2>
<form action="/admin/questions/create" method="post">
    <div class="form-group">
        <label for="subject_id">Subject:</label>
        <select id="subject_id" name="subject_id" required onchange="filterTopics()">
            <option value="">-- Select Subject --</option>
            {% for subject in subjects %}
            <option value="{{ subject.id }}">{{ subject.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="topic_id">Topic:</label>
        <!-- In a real app we'd fetch these dynamically via AJAX. 
                 For now, we'll load all and filter via JS or just list them all. 
                 Let's stick to simple list for MVP or fetch all. -->
        <select id="topic_id" name="topic_id" required>
            <option value="">-- Select Topic --</option>
            {% for topic in topics %}
            <option value="{{ topic.id }}" data-subject="{{ topic.subject_id }}">{{ topic.name }} ({{ topic.subject_id
                }})</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Question Type:</label>
        <label><input type="radio" name="question_type" value="MCQ" checked onclick="toggleType('MCQ')"> MCQ
            (Single)</label>
        <label><input type="radio" name="question_type" value="MSQ" onclick="toggleType('MSQ')"> MSQ (Multiple)</label>
        <label><input type="radio" name="question_type" value="NAT" onclick="toggleType('NAT')"> NAT (Numeric)</label>
        <label><input type="radio" name="question_type" value="SUBJECTIVE" onclick="toggleType('SUBJECTIVE')">
            Subjective</label>
    </div>

    <div class="form-group">
        <label for="text">Question Text:</label>
        <textarea id="text" name="text" rows="3" required></textarea>
    </div>

    <div class="form-group">
        <label for="difficulty">Difficulty (1-5):</label>
        <input type="number" id="difficulty" name="difficulty" min="1" max="5" value="1" required>
    </div>

    <!-- Options Section (MCQ / MSQ) -->
    <div id="options-section">
        <h3>Options</h3>
        <div class="form-group">
            <label>Option A (ID: opt_a):</label>
            <input type="text" name="option_a">
        </div>
        <div class="form-group">
            <label>Option B (ID: opt_b):</label>
            <input type="text" name="option_b">
        </div>
        <div class="form-group">
            <label>Option C (ID: opt_c):</label>
            <input type="text" name="option_c">
        </div>
        <div class="form-group">
            <label>Option D (ID: opt_d):</label>
            <input type="text" name="option_d">
        </div>

        <!-- MCQ Correct Answer -->
        <div id="mcq-correct" class="form-group">
            <label for="correct_option_id">Correct Option (MCQ):</label>
            <select name="correct_option_id_select">
                <option value="opt_a">Option A</option>
                <option value="opt_b">Option B</option>
                <option value="opt_c">Option C</option>
                <option value="opt_d">Option D</option>
            </select>
        </div>

        <!-- MSQ Correct Answer -->
        <div id="msq-correct" class="form-group" style="display: none;">
            <label>Correct Options (MSQ):</label>
            <br>
            <label><input type="checkbox" name="correct_option_ids" value="opt_a"> Option A</label>
            <label><input type="checkbox" name="correct_option_ids" value="opt_b"> Option B</label>
            <label><input type="checkbox" name="correct_option_ids" value="opt_c"> Option C</label>
            <label><input type="checkbox" name="correct_option_ids" value="opt_d"> Option D</label>
        </div>
    </div>

    <!-- NAT Section -->
    <div id="nat-section" style="display: none;">
        <div class="form-group">
            <label for="answer_value">Correct Answer Value:</label>
            <input type="text" id="answer_value" name="answer_value">
        </div>
    </div>

    <!-- Optional Fields Section -->
    <details>
        <summary style="cursor: pointer; margin-bottom: 15px; font-weight: bold;">Advanced / Optional Fields</summary>
        <div style="padding-left: 15px; border-left: 2px solid #eee;">
            <div class="form-group">
                <label for="solution">Solution / Explanation:</label>
                <textarea id="solution" name="solution" rows="4"></textarea>
            </div>

            <div class="form-group">
                <label for="target_exam_tags">Target Exam Tags (comma-separated):</label>
                <input type="text" id="target_exam_tags" name="target_exam_tags">
            </div>

            <div class="form-group">
                <label for="tags">Tags (comma-separated):</label>
                <input type="text" id="tags" name="tags">
            </div>

            <div class="form-group">
                <label for="source">Source:</label>
                <input type="text" id="source" name="source">
            </div>

            <div class="form-group">
                <label for="version">Version:</label>
                <input type="text" id="version" name="version" value="1.0">
            </div>

            <div class="form-group">
                <label for="metadata">Metadata (JSON):</label>
                <textarea id="metadata" name="metadata" rows="4"></textarea>
                <small style="color: #666;">Enter valid JSON.</small>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="is_active" name="is_active" value="true" checked>
                    Is Active
                </label>
            </div>
        </div>
    </details>

    <button type="submit" class="btn-submit">Create Question</button>
</form>

<script>
    function toggleType(type) {
        const optionsSection = document.getElementById('options-section');
        const natSection = document.getElementById('nat-section');
        const mcqCorrect = document.getElementById('mcq-correct');
        const msqCorrect = document.getElementById('msq-correct');

        // Reset visibility
        optionsSection.style.display = 'none';
        natSection.style.display = 'none';
        mcqCorrect.style.display = 'none';
        msqCorrect.style.display = 'none';

        if (type === 'MCQ') {
            optionsSection.style.display = 'block';
            mcqCorrect.style.display = 'block';
        } else if (type === 'MSQ') {
            optionsSection.style.display = 'block';
            msqCorrect.style.display = 'block';
        } else if (type === 'NAT') {
            natSection.style.display = 'block';
        }
        // Subjective has no specific answer input beyond text/solution usually, or maybe no auto-check
    }

    function filterTopics() {
        var subjectId = document.getElementById('subject_id').value;
        var topicSelect = document.getElementById('topic_id');
        var options = topicSelect.querySelectorAll('option');

        for (var i = 0; i < options.length; i++) {
            var opt = options[i];
            if (opt.value === "") continue;
            if (subjectId === "" || opt.getAttribute('data-subject') === subjectId) {
                opt.style.display = 'block';
            } else {
                opt.style.display = 'none';
            }
        }
        topicSelect.value = "";
    }
</script>
{% endblock %}